# Why ID Shows Negative Numbers - Explained

## The Question
"Why does Add New make ID go negative?"

## The Short Answer
**It's normal!** Negative IDs are temporary placeholders for new unsaved records. Once you save, the database assigns the real positive ID.

## How It Works

### The Process:

```
Step 1: Click "Add New"
????????????????????
? ID: -1           ? ? Temporary negative ID (from DataSet)
? Challan: ______  ?
? Date: ________   ?
????????????????????

Step 2: Enter Data
????????????????????
? ID: -1           ? ? Still negative (not saved yet)
? Challan: CH001   ?
? Date: 1/1/2025   ?
????????????????????

Step 3: Click "Save"
????????????????????
? ID: 47           ? ? Real ID from database!
? Challan: CH001   ?
? Date: 1/1/2025   ?
????????????????????
```

## Why Negative IDs Exist

Microsoft's ADO.NET DataSet uses negative IDs for new records because:

### 1. **Tracking New Records**
```
Negative ID = New (not in database yet)
Positive ID = Saved (exists in database)
```

### 2. **Multiple New Records**
If you add several records before saving:
```
Record 1: ID = -1
Record 2: ID = -2
Record 3: ID = -3
```
Each gets a unique temporary ID.

### 3. **Avoiding Conflicts**
Negative IDs can never conflict with real database IDs (which start at 1).

## Technical Details

### What Happens Behind the Scenes:

1. **AddNew() is Called**
   ```csharp
   this.machinery_item_inward_unit2BindingSource.AddNew();
   ```
   - DataSet creates a new DataRow
   - Assigns temporary ID: -1, -2, -3, etc.
   - Row is marked as "Added" (not yet in DB)

2. **You Enter Data**
   - Data goes into the temporary row
   - ID stays negative

3. **Save is Called**
   ```csharp
   this.tableAdapterManager.UpdateAll(this.mainDB);
   ```
   - SQL INSERT statement is executed
   - Database generates real ID (IDENTITY column)
   - DataSet updates the row with real ID
   - Row is now marked as "Unchanged"

### The SQL Behind It:

```sql
-- What the database does:
INSERT INTO machinery_item_inward_unit2 
    (challan_no, date, party_name, ...) 
VALUES 
    ('CH001', '2025-01-01', 'ABC Ltd', ...);

-- Database auto-generates ID:
-- New record gets ID = 47 (next available)

-- Then returns the new ID back to the application
SELECT id FROM machinery_item_inward_unit2 
WHERE id = SCOPE_IDENTITY();
```

## The Fix: Show "Auto" Instead

I've updated the form to show **"Auto"** instead of negative numbers for new records:

### Before Fix:
```
????????????????
? ID: -1       ? ? Confusing!
? Challan:     ?
????????????????
```

### After Fix:
```
????????????????
? ID: Auto     ? ? Clear!
? Challan:     ?
????????????????
```

### How It Works:

```csharp
private void BindingSource_CurrentChanged(object sender, EventArgs e)
{
    // Check if ID is negative
    if (id < 0)
    {
        this.idTextBox.Text = "Auto"; // Show "Auto" instead
    }
}
```

## When You See Each Value

| Situation | ID Shown | Meaning |
|-----------|----------|---------|
| Form opens | "Auto" | New unsaved record |
| After Add New | "Auto" | New unsaved record |
| After typing data | "Auto" | Still unsaved |
| After Save | 47 (example) | Saved! Real DB ID |
| Browsing old records | 1, 2, 3... | Existing saved records |

## Is This a Bug?

**No!** This is standard ADO.NET behavior and is actually a feature:

? **Good Design** - Separates new from existing records  
? **Prevents Conflicts** - No ID collision  
? **Tracks State** - Easy to tell what's saved vs. unsaved  
? **Industry Standard** - Used in all .NET data applications  

## Other Frameworks

This pattern is used everywhere:

| Framework | New Record ID |
|-----------|---------------|
| **ADO.NET** | Negative (-1, -2, -3) |
| **Entity Framework** | 0 or negative |
| **WinForms DataSet** | Negative |
| **WPF** | Negative |
| **Access** | (AutoNumber) placeholder |
| **SQL Server Management Studio** | NULL or (New) |

## Common Questions

### Q: Can I change it to show 0 instead?
**A:** Not recommended - 0 could be confused with a real ID. "Auto" or blank is better.

### Q: Can I see the negative ID in the database?
**A:** No - negative IDs never go to the database. They're only in memory.

### Q: What if I add multiple records without saving?
**A:** Each gets a unique negative ID (-1, -2, -3). All save correctly.

### Q: Does it affect the final ID in the database?
**A:** No! Database ignores the temporary ID and assigns its own (1, 2, 3...).

## Workflow Examples

### Example 1: Single Record
```
1. Open form ? ID shows "Auto"
2. Enter: Challan=CH001, Date=Today
3. Click Save ? ID changes to 47
4. New blank form appears ? ID shows "Auto" again
5. Ready for next entry
```

### Example 2: Multiple Records
```
1. Add New ? ID = "Auto" (internally -1)
2. Enter data but DON'T save
3. Add New again ? ID = "Auto" (internally -2)
4. Enter data
5. Add New again ? ID = "Auto" (internally -3)
6. Click Save All ? IDs become 47, 48, 49
```

## Summary

### What You See:
- **"Auto"** = New record, not saved yet
- **Positive number** = Saved record with real database ID

### What's Happening:
- Temporary negative IDs in memory (-1, -2, -3...)
- Database assigns real IDs when saved (1, 2, 3...)
- Form updates to show real ID after save

### What To Do:
- **Nothing!** Just ignore the ID field
- Focus on entering your data
- Click Save
- ID will be correct automatically

## Bottom Line

**You don't need to worry about IDs at all!**

Just:
1. Enter your data
2. Click Save
3. Database handles the ID automatically

The "Auto" text reminds you that the ID will be generated automatically - no need to think about it!

---

**Status**: ? Fixed - Now shows "Auto" instead of negative numbers  
**Build**: ? Successful  
**User Action**: ? None needed - works automatically
